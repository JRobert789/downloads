(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0b68cd"],{"1e47":function(t,e,a){"use strict";a.r(e);var n=a("1da1"),i=a("5530"),o=a("ade3"),s=(a("96cf"),a("d3b7"),a("4de4"),a("b0c0"),a("d81d"),a("a9e3"),{name:"rouletteTarget",data:function(){var t=[{code:"all",text:this.$t("all")},{code:"0",text:this.tFn("unextract")},{code:"1",text:this.tFn("extracted")}];return{userName:"",commodityId:"",status:"all",statusMap:t.reduce((function(t,e){return Object.assign(t,Object(o.a)({},e.code,e.text))}),{}),statusArr:t,page:1,size:10,totalElements:0,loading:!1,dataList:[],columns:[{title:this.$t("event.createTime"),key:"createTime"},{title:this.tFn("username"),key:"userName"},{title:this.tFn("cname"),slot:"commodityName"},{title:this.tFn("cid"),key:"commodityId"},{title:this.tFn("camount"),slot:"formatAmount"},{title:this.tFn("lotteryStatus"),key:"formatStatus"},{title:this.tFn("updateTime"),key:"updateTime"},{title:this.$t("operation"),slot:"operation"}],add:!1,targetUserName:"",setting:!1,targetCommodityId:"",commodityList:[],count:1}},computed:{targetDisabled:function(){return!(this.targetUserName&&this.targetCommodityId&&this.count)},commodityIdMap:function(){return this.commodityList.reduce((function(t,e){return Object(i.a)(Object(i.a)({},t),{},Object(o.a)({},e.id,e))}),{})}},methods:{deleteHandler:function(t){var e=this;this.loading=!0;var a=t.id;this.$post("/activity/roulette/tob/removeTarget",{id:a}).then((function(){e.dataList=e.dataList.filter((function(t){return t.id!==a}))})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1}))},getCommodityMoney:function(t){if(t){var e=this.commodityIdMap[t]||{};return this.$utils.toYuan(e.money)}return""},getCommodityName:function(t){return t?(this.commodityIdMap[t]||{}).name:""},showAdd:function(){this.add=!0},getCommodityList:function(){var t=this;return this.setting=!0,this.$get("/activity/roulette/tob/getCommodityList").then((function(e){t.commodityList=e||[]})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.setting=!1}))},closeHandler:function(){this.targetUserName="",this.add=!1,this.targetCommodityId="",this.count=1},addHandler:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.setting){e.next=2;break}return e.abrupt("return");case 2:return t.setting=!0,e.prev=3,e.next=6,t.getUserId(t.targetUserName);case 6:return a=e.sent,e.next=9,t.submitHandler(a,t.targetCommodityId,t.count);case 9:t.closeHandler(),t.getConfigList(1),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),t.$Message.error(e.t0.message);case 16:return e.prev=16,t.setting=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})))()},submitHandler:function(t,e,a){return this.$post("/activity/roulette/tob/setTargetCommodityByUserId",{userId:t,commodityId:e,count:a})},getUserId:function(t){return this.$post("/user/tob/getUserDetailByName",{userName:t}).then((function(t){return t.id}))},pageSizeChange:function(t){this.size=t,this.getConfigList(1)},tFn:function(t,e){return this.$t("roulette.".concat(t),e)},getConfigList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.loading=!0,this.$get("/activity/roulette/tob/getTargetPage",{userName:this.userName,commodityId:this.commodityId,status:"all"===this.status?"":this.status,page:this.page=e,size:this.size}).then((function(e){var a=e||{content:[]},n=a.content,o=a.totalElements;t.dataList=n.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{formatStatus:t.statusMap[e.status]})})),t.totalElements=Number(o)||0})).catch((function(e){t.dataList=[],t.totalElements=0,t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}},mounted:function(){this.getConfigList(1),this.getCommodityList()}}),r=s,c=a("2877"),u=Object(c.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"roulette_target"},[t.loading?a("Spin",{attrs:{fix:""}}):t._e(),a("Form",{attrs:{inline:""}},[a("FormItem",[t._v(" "+t._s(t.tFn("username"))+" "),a("Input",{staticStyle:{width:"140px"},attrs:{type:"text",maxlength:"30"},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),a("FormItem",[t._v(" "+t._s(t.tFn("cid"))+" "),a("Input",{staticStyle:{width:"140px"},attrs:{type:"text"},model:{value:t.commodityId,callback:function(e){t.commodityId=e},expression:"commodityId"}})],1),a("FormItem",[t._v(" "+t._s(t.tFn("lotteryStatus"))+" "),a("Select",{staticStyle:{width:"auto","min-width":"100px"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.statusArr,(function(e){return a("Option",{key:e.code,attrs:{value:e.code}},[t._v(" "+t._s(e.text)+" ")])})),1)],1),a("FormItem",[a("Button",{attrs:{type:"primary",icon:"md-search"},on:{click:function(e){return t.getConfigList(1)}}},[t._v(t._s(t._f("lang")("search")))])],1),t.pageauthoritys.add?a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.showAdd}},[t._v(t._s(t._f("lang")("add")))])],1):t._e()],1),a("m-table",{attrs:{size:"small",columns:t.columns,data:t.dataList},scopedSlots:t._u([{key:"commodityName",fn:function(e){var n=e.row;return[a("span",[t._v(" "+t._s(t.getCommodityName(n.commodityId))+" ")])]}},{key:"formatAmount",fn:function(e){var n=e.row;return[a("span",[t._v(" "+t._s(t.getCommodityMoney(n.commodityId))+" ")])]}},{key:"operation",fn:function(e){var n=e.row;return[t.pageauthoritys.delete?a("Tooltip",{attrs:{confirm:"",content:t.$t("delete"),placement:"top"}},[a("Poptip",{attrs:{confirm:"",title:t.$t("event.confirmText1")},on:{"on-ok":function(e){return t.deleteHandler(n)}}},[a("Button",{attrs:{size:"small",icon:"md-trash"}})],1)],1):t._e()]}}])}),a("m-page",{attrs:{total:t.totalElements,pageSize:t.size},on:{"on-change":t.getConfigList,"on-page-size-change":t.pageSizeChange},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}),a("Modal",{attrs:{width:"400",title:t.tFn("targetedProductSettings")},model:{value:t.add,callback:function(e){t.add=e},expression:"add"}},[t.setting?a("Spin",{attrs:{fix:""}}):t._e(),a("Form",{attrs:{"label-width":100}},[a("FormItem",{attrs:{label:t.tFn("username")}},[a("Input",{staticStyle:{width:"200px"},model:{value:t.targetUserName,callback:function(e){t.targetUserName=e},expression:"targetUserName"}})],1),a("FormItem",{attrs:{label:t.tFn("cname")}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.targetCommodityId,callback:function(e){t.targetCommodityId=e},expression:"targetCommodityId"}},t._l(t.commodityList,(function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),a("FormItem",{attrs:{label:t.tFn("count")}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:1},model:{value:t.count,callback:function(e){t.count=e},expression:"count"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:t.closeHandler}},[t._v(t._s(t.$t("cancel")))]),a("Button",{attrs:{type:"primary",loading:t.setting,disabled:t.targetDisabled},on:{click:t.addHandler}},[t._v(t._s(t.$t("confirm")))])],1)],1)],1)}),[],!1,null,"386a673b",null);e.default=u.exports}}]);