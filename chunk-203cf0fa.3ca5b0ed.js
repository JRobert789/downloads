(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-203cf0fa"],{"68f7":function(t,e,n){"use strict";n.r(e);var a=(n("ac1f"),n("466d"),n("5319"),n("a9e3"),n("d3b7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Drawer",{attrs:{title:t.drawerTitle,width:"750"},model:{value:t.value2,callback:function(e){t.value2=e},expression:"value2"}},[n("Form",{ref:"form",attrs:{model:t.form,rules:t.rule,"label-width":150}},["batchEdit"!=t.drawerType?n("FormItem",{attrs:{label:t.tFn("userName")}},[n("Input",{staticStyle:{width:"150px"},attrs:{type:"text",disabled:Boolean(this.detail)},model:{value:t.form.userName,callback:function(e){t.$set(t.form,"userName",e)},expression:"form.userName"}})],1):n("FormItem",{attrs:{label:t.tFn("userName")}},t._l(t.userList,(function(e){return n("span",{key:e.id},[t._v(t._s(e.userName)+", ")])})),0),n("FormItem",{attrs:{label:t.tFn("whetherAllSubordinatesTips")}},[n("RadioGroup",{model:{value:t.form.subordinate,callback:function(e){t.$set(t.form,"subordinate",e)},expression:"form.subordinate"}},t._l(t.subordinateList,(function(e){return n("Radio",{key:e.value,attrs:{label:e.value}},[n("span",[t._v(t._s(e.label))])])})),1),n("div",{staticStyle:{color:"red"}},[t._v(t._s(t.tFn("noteYesAndNoAllSubordinatesTips")))])],1),n("FormItem",{attrs:{label:t.tFn("setting"),prop:"probabilityAmountList"}},[t._l(t.form.probabilityAmountList,(function(e,a){return n("div",{key:a,staticStyle:{"margin-bottom":"20px","margin-top":"2px"}},[t._v(" "+t._s(t.tFn("triggerProbability"))+" "),n("Input",{staticStyle:{width:"100px","margin-right":"2px"},attrs:{type:"number"},on:{"on-blur":function(n){e.ratio=t.zzNumber(e.ratio)}},model:{value:e.ratio,callback:function(n){t.$set(e,"ratio",n)},expression:"item.ratio"}}),t._v("% "+t._s(t.tFn("matchOrderBalance"))+" "),n("Input",{staticStyle:{width:"100px","margin-right":"2px"},attrs:{type:"number"},on:{"on-blur":function(n){e.minBalancePercent=t.zzNumber(e.minBalancePercent)}},model:{value:e.minBalancePercent,callback:function(n){t.$set(e,"minBalancePercent",n)},expression:"item.minBalancePercent"}}),t._v("%~ "),n("Input",{staticStyle:{width:"100px","margin-right":"2px"},attrs:{type:"number"},on:{"on-blur":function(n){e.maxBalancePercent=t.zzNumber(e.maxBalancePercent)}},model:{value:e.maxBalancePercent,callback:function(n){t.$set(e,"maxBalancePercent",n)},expression:"item.maxBalancePercent"}}),t._v("% "),a>0?n("Icon",{staticStyle:{"margin-left":"5px","vertical-align":"middle"},attrs:{type:"ios-trash",size:"30",color:"red"},on:{click:function(e){return t.deleteRule(a)}}}):t._e()],1)})),t.form.probabilityAmountList.length<2?n("Button",{attrs:{type:"primary"},on:{click:t.addRule}},[t._v(t._s(t.tFn("addConditions")))]):t._e()],2),n("FormItem",[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.save()}}},[t._v(t._s(t._f("lang")("confirm")))]),n("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.clear()}}},[t._v(t._s(t._f("lang")("cancel")))]),n("div",{staticStyle:{color:"red"}},[t._v(t._s(t.tFn("warmTips"))+": "+t._s(t.tFn("modificationsOneHourLaterTips")))])],1)],1),t.loading?n("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)}),r=n("1da1"),i=(n("96cf"),n("159b"),n("b680"),n("d81d"),n("99af"),n("a434"),{props:{value:{default:!1,type:Boolean},detail:{default:null,type:Object},drawerType:{default:"",type:String},userList:{default:function(){return[]},type:Array}},data:function(){return{drawerTitle:"",loading:!1,form:{userName:"",id:"",subordinate:0,probabilityAmountList:[{ratio:null,minBalancePercent:null,maxBalancePercent:null}]},showSpin:!1,rule:{subordinate:[{required:!0,message:this.tFn("pleaseSelectAllSubordinates"),trigger:"blur"}]},subordinateList:[{label:this.tFn("yes"),value:1},{label:this.tFn("no"),value:0}]}},methods:{tFn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$t("grabSet.".concat(t),e)},zzNumber:function(t){if(t){var e=(t=String(t)).match(/^\d*(\.?\d{0,2})/g)[0];return"."===e.charAt(0)?e.replace(/./,""):"0"===e.charAt(0)&&"."!==e.charAt(1)&&e.length>=2?parseFloat(e):Number(e)}},init:function(){if(this.form=this.$options.data.call(this).form,this.$refs.form.resetFields(),this.detail){var t=this.detail,e=t.id,n=t.probabilityAmountList,a=t.userName;n.forEach((function(t){t.maxBalancePercent=(t.maxBalancePercent/100).toFixed(2),t.minBalancePercent=(t.minBalancePercent/100).toFixed(2),t.ratio=(t.ratio/100).toFixed(2)})),this.form={userName:a,id:e,subordinate:0,probabilityAmountList:n}}Boolean(this.detail)||"batchEdit"==this.drawerType?this.drawerTitle=this.tFn("edit"):this.drawerTitle=this.tFn("new")},clear:function(){this.form=this.$options.data.call(this).form,this.$emit("input",!1)},handleSumbit:function(){var t=this,e=this.form.probabilityAmountList;return new Promise((function(n,a){"add"==t.drawerType&&""==t.form.userName&&a(t.tFn("pleaseEnterUserName")),e.map((function(e){""!=e.ratio&&null!=e.ratio&&null!=e.ratio||a(t.tFn("pleaseEnterTriggerProbability")),""!=e.minBalancePercent&&null!=e.minBalancePercent&&null!=e.minBalancePercent||a(t.tFn("pleaseEnterMinimumBalance")),""!=e.maxBalancePercent&&null!=e.maxBalancePercent&&null!=e.maxBalancePercent||a(t.tFn("pleaseEnterTheMaximumBalance")),(Number(e.ratio)>100||Number(e.ratio)<.01)&&a(t.tFn("triggerProbabilityRangePercentTips")),(Number(e.minBalancePercent)>100||Number(e.minBalancePercent)<.01)&&a(t.tFn("theMinimumBalancePercentTips")),(Number(e.maxBalancePercent)>100||Number(e.maxBalancePercent)<.01)&&a(t.tFn("theMaximumBalancePercentTips")),Number(e.maxBalancePercent)<=Number(e.minBalancePercent)&&a(t.tFn("valueBalanceEqualTips"))}));var r=e.reduce((function(t,e){return t+Number(e.ratio)}),0);r>100&&a(t.tFn("totalTriggerProbabilityPercentTips")),n()}))},save:function(){var t=this;this.$refs.form.validate(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}if(!t.loading){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t.handleSumbit().then((function(){if(t.loading=!0,"batchEdit"==t.drawerType){var e=t.form,n=e.subordinate,a=e.probabilityAmountList;t.userList.map((function(t){delete t.probabilityAmountList,delete t.createTime})),t.batchForm={subordinate:n,probabilityAmountList:a,userInfos:t.userList};var r=JSON.parse(JSON.stringify(t.batchForm));r.subordinate=Number(r.subordinate),r.probabilityAmountList.forEach((function(t){t.maxBalancePercent=Number(100*t.maxBalancePercent),t.minBalancePercent=Number(100*t.minBalancePercent),t.ratio=Number(100*t.ratio)})),t.$post("/platform/UserGrabConfig/tob/batchUpdate",r,{"Content-type":"application/json;charset=UTF-8"}).then((function(){t.$Message.success("".concat(t.$t("rebate.editSucceeded"),", ").concat(t.tFn("modificationsOneHourLaterTips"),"。")),t.$emit("save"),t.$emit("input",!1)})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}else{var i=Boolean(t.detail),o=i?"/platform/UserGrabConfig/tob/update":"/platform/UserGrabConfig/tob/save",s=JSON.parse(JSON.stringify(t.form));s.subordinate=Number(s.subordinate),s.probabilityAmountList.forEach((function(t){t.maxBalancePercent=Number(100*t.maxBalancePercent),t.minBalancePercent=Number(100*t.minBalancePercent),t.ratio=Number(100*t.ratio)})),t.$post(o,s,{"Content-type":"application/json;charset=UTF-8"}).then((function(){t.$Message.success(i?"".concat(t.$t("rebate.editSucceeded"),", ").concat(t.tFn("modificationsOneHourLaterTips"),"。"):"".concat(t.$t("rebate.addSucceeded"),", ").concat(t.tFn("modificationsOneHourLaterTips"),"。")),t.$emit("save"),t.$emit("input",!1)})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}})).catch((function(e){t.$Message.error(e)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},deleteRule:function(t){this.form.probabilityAmountList.splice(t,1),this.$forceUpdate()},addRule:function(){this.form.probabilityAmountList.push({ratio:null,minBalancePercent:null,maxBalancePercent:null}),this.$forceUpdate()}},computed:{value2:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},watch:{value:function(t){t?this.init():this.clear()}}}),o=i,s=(n("a7a2"),n("2877")),c={name:"userGrabSet",data:function(){return{userName:"",subordinate:0,detail:null,showDrawer:!1,columns:[{type:"selection",width:60,align:"center"},{title:this.tFn("serialNumber"),slot:"key",width:80,align:"center"},{title:this.tFn("userName"),key:"userName",width:250,align:"center"},{title:this.tFn("triggerProbability"),slot:"ratio",align:"center"},{title:this.tFn("matchOrderBalance"),slot:"rengeBalancePercent",align:"center"},{title:this.tFn("createTime"),key:"createTime",align:"center"},{title:this.tFn("operation"),slot:"operation",align:"center"}],dataList:[],showSpin:!1,page:1,size:20,totalElements:0,userList:[],drawerType:""}},components:{drawer:Object(s.a)(o,a,[],!1,null,"0af65d93",null).exports},methods:{zzNumber:function(t){if(t){var e=(t=String(t)).match(/^\d*(\.?\d{0,2})/g)[0];return"."===e.charAt(0)?e.replace(/./,""):"0"===e.charAt(0)&&"."!==e.charAt(1)&&e.length>=2?parseFloat(e):Number(e)}},clear:function(){this.userName=""},tFn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$t("grabSet.".concat(t),e)},edit:function(t){this.detail=JSON.parse(JSON.stringify(t)),this.showDrawer=!0},save:function(){this.userList=[],this.drawerType="",this.query()},query:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.showSpin=!0;var n={page:e,size:this.size,userName:this.userName};this.$get("/platform/UserGrabConfig/tob/page",n).then((function(e){t.dataList=e.content||[],t.totalElements=+e.totalElements})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.showSpin=!1}))},search:function(){this.page=1,this.query()},pageSizeChange:function(t){this.size=t,this.query()},del:function(t){var e=this;this.$Modal.confirm({title:this.tFn("confirmToDelete"),render:function(t){return t("Checkbox",{props:{trueValue:1,falseValue:0,value:e.subordinate},on:{"on-change":function(t){e.subordinate=t}}},e.tFn("deleteTips"))},onOk:function(){e.showSpin=!0;var n={id:t,subordinate:e.subordinate};e.$post("/platform/UserGrabConfig/tob/delete",n,{"Content-type":"application/json;charset=UTF-8"}).then((function(){e.$Message.success(e.$t("deleteSuccess"))})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.subordinate=0,e.showSpin=!1,e.query()}))},onCancel:function(){e.subordinate=0}})},selectHandle:function(t){this.userList=t},showSettingDrawer:function(t,e){"batchEdit"!=t||0!=this.userList.length?("edit"==t&&(this.detail=JSON.parse(JSON.stringify(e))),this.drawerType=t,this.showDrawer=!0):this.$Message.error(this.tFn("checkOptionTips"))}},watch:{showDrawer:function(t){t||(this.detail=null)}},mounted:function(){this.query()}},l=c,u=(n("b5d8"),Object(s.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"reward__settings"},[n("Form",{staticClass:"rs_form",attrs:{inline:""}},[n("FormItem",{attrs:{label:t.tFn("userName"),"label-width":60}},[n("Input",{attrs:{type:"text"},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),n("FormItem",[n("Button",{attrs:{type:"primary",icon:"md-search"},on:{click:function(e){return t.search()}}},[t._v(t._s(t.tFn("search")))])],1),n("FormItem",[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.clear()}}},[t._v(t._s(t.tFn("cleanSearch")))])],1),n("FormItem",[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.showSettingDrawer("add")}}},[t._v(t._s(t.tFn("addUserGrabSetting")))])],1),n("FormItem",[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.showSettingDrawer("batchEdit")}}},[t._v(t._s(t.tFn("batchEditUserGrabSetting")))])],1)],1),n("Table",{ref:"selection",attrs:{border:"",columns:t.columns,data:t.dataList,"no-data-text":t.$t("rebate.noData")},on:{"on-selection-change":t.selectHandle},scopedSlots:t._u([{key:"key",fn:function(e){var a=e.index;return[n("span",[t._v(t._s(a+1))])]}},{key:"ratio",fn:function(e){var a=e.row;return t._l(a.probabilityAmountList,(function(e,r){return n("div",{key:a.probabilityAmountList[r].ratio+r},[t._v(t._s((a.probabilityAmountList[r].ratio/100).toFixed(2))+"%")])}))}},{key:"rengeBalancePercent",fn:function(e){var a=e.row;return t._l(a.probabilityAmountList,(function(e,r){return n("div",{key:a.probabilityAmountList[r].minBalancePercent+r},[t._v(t._s((a.probabilityAmountList[r].minBalancePercent/100).toFixed(2))+"% ~ "+t._s((a.probabilityAmountList[r].maxBalancePercent/100).toFixed(2))+"%")])}))}},{key:"operation",fn:function(e){var a=e.row;return[n("Button",{staticStyle:{"margin-right":"10px"},attrs:{icon:"md-create"},on:{click:function(e){return t.showSettingDrawer("edit",a)}}}),n("Button",{attrs:{icon:"ios-trash"},on:{click:function(e){return t.del(a.id)}}})]}}])}),n("m-page",{ref:"pageRef",attrs:{total:t.totalElements,pageSize:t.size,pageSizeOpts:[20,30,50,100,500]},on:{"on-change":t.query,"on-page-size-change":t.pageSizeChange},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}),t.showSpin?n("Spin",{attrs:{size:"large",fix:""}}):t._e(),n("drawer",{attrs:{detail:t.detail,drawerType:t.drawerType,userList:t.userList},on:{save:function(e){return t.save()}},model:{value:t.showDrawer,callback:function(e){t.showDrawer=e},expression:"showDrawer"}})],1)}),[],!1,null,"75845c28",null));e.default=u.exports},8154:function(t,e,n){},a7a2:function(t,e,n){"use strict";n("b49e")},b49e:function(t,e,n){},b5d8:function(t,e,n){"use strict";n("8154")}}]);