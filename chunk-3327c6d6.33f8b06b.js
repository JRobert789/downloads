(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3327c6d6"],{"0fc1":function(t,e,n){"use strict";n("ede7")},a7d1:function(t,e,n){"use strict";n.r(e);var a=(n("7db0"),n("d3b7"),n("4e82"),n("a9e3"),n("caad"),n("2532"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Drawer",{attrs:{width:880,title:t.title},on:{"on-close":t.cancelHandler},model:{value:t.value2,callback:function(e){t.value2=e},expression:"value2"}},[n("div",{staticClass:"edit_event"},[n("Form",{ref:"formItem",staticClass:"event_content",attrs:{model:t.formItem,"label-width":160,rules:t.ruleValidate}},[n("FormItem",{attrs:{label:t.tFn("type"),prop:"type"}},[n("RadioGroup",{model:{value:t.formItem.eventType,callback:function(e){t.$set(t.formItem,"eventType",e)},expression:"formItem.eventType"}},[n("Radio",{attrs:{label:1,disabled:""}},[t._v(t._s(t.tFn("normalAct")))])],1)],1),n("FormItem",{attrs:{label:t.tFn("title"),prop:"title"}},[n("Input",{staticStyle:{width:"200px"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),n("FormItem",{attrs:{label:t.tFn("titleDes"),prop:"titleDesc"}},[n("Input",{staticStyle:{width:"200px"},model:{value:t.formItem.titleDesc,callback:function(e){t.$set(t.formItem,"titleDesc",e)},expression:"formItem.titleDesc"}})],1),n("FormItem",{attrs:{label:t.tFn("actTime"),prop:"actTime"}},[n("DatePicker",{staticStyle:{width:"320px"},attrs:{type:"datetimerange"},on:{"on-clear":t.clearDate},model:{value:t.formItem.actTime,callback:function(e){t.$set(t.formItem,"actTime",e)},expression:"formItem.actTime"}})],1),n("FormItem",{attrs:{label:t.tFn("image"),prop:"img"}},[n("upload",{ref:"upRef",attrs:{list:t.upList},on:{"upload-remove":t.uploadRemove,"upload-success":t.uploadSuccess},model:{value:t.formItem.img,callback:function(e){t.$set(t.formItem,"img",e)},expression:"formItem.img"}})],1),n("FormItem",{attrs:{label:t.tFn("actReadme")}},[n("editor",{staticStyle:{width:"600px"},attrs:{handleShowChange:t.handleShowChange},model:{value:t.formItem.eventDesc,callback:function(e){t.$set(t.formItem,"eventDesc",e)},expression:"formItem.eventDesc"}})],1)],1),n("div",{staticClass:"event_btns"},[n("Button",{staticStyle:{"margin-right":"16px"},on:{click:t.cancelHandler}},[t._v(t._s(t._f("lang")("cancel")))]),n("Button",{attrs:{type:"primary"},on:{click:t.saveHandler}},[t._v(t._s(t._f("lang")("save")))])],1)],1),t.loading?n("Spin",{attrs:{fix:""}}):t._e()],1)}),i=n("9dac"),o=n("a897"),s={props:{value:{default:null,type:Object}},data:function(){return{formItem:{eventType:1,title:"",titleDesc:"",actTime:[null,null],eventDesc:"",sort:0},ruleValidate:{title:[{required:!0,message:this.tFn("rule1"),trigger:"blur"}],actTime:[{required:!0,validator:function(t,e){return e&&e.every((function(t){return!!t}))},message:this.tFn("rule2"),trigger:"blur"}],img:[{required:!0,type:"string",message:this.tFn("rule4"),trigger:"change"}]},upList:[],handleShowChange:!1,loading:!1}},components:{upload:i.a,editor:o.a},methods:{saveHandler:function(){var t=this;this.loading||this.$refs.formItem.validate().then((function(e){if(e){var n={eventType:t.formItem.eventType,title:t.formItem.title,titleDesc:t.formItem.titleDesc,beginTime:t.$utils.formatDate(t.formItem.actTime[0],"YYYY-MM-DD hh:mm:ss"),endTime:t.$utils.formatDate(t.formItem.actTime[1],"YYYY-MM-DD hh:mm:ss"),eventDesc:t.formItem.eventDesc,img:t.formItem.img,sort:t.formItem.sort},a="/activity/event/tob/add";t.value.id&&(n.id=t.value.id,a="/activity/event/tob/update"),t.loading=!0,t.$post(a,n).then((function(){t.$Message.success(t.$t("success")),t.$emit("onSuccess"),t.cancelHandler()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}}))},uploadRemove:function(){this.formItem.img=""},uploadSuccess:function(t){this.$set(this.formItem,"img",t.path)},tFn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.includes("event.")||(t="event.".concat(t)),this.$t(t,e)},clearDate:function(){this.formItem.actTime=this.$utils.getTodayArr()},clearData:function(){this.formItem={eventType:1,title:"",titleDesc:"",actTime:[null,null],eventDesc:"",sort:0},this.upList=[]},cancelHandler:function(){this.value2=null,this.clearData()}},watch:{value:function(t){if(t){this.$refs.upRef.handleRemove();var e=t.title,n=t.titleDesc,a=t.beginTime,i=t.endTime,o=t.eventDesc,s=t.eventType,l=void 0===s?1:s,r=t.img,c=t.sort;r=r&&this.$formatImageUrl(r),this.formItem={eventType:l,title:e,titleDesc:n,actTime:[a,i],eventDesc:o,img:r,sort:c||0},r&&(this.upList.length=0,this.upList.push({name:"pic",url:r}),this.$refs.upRef.setUploadList(this.upList))}else this.clearData()}},computed:{title:function(){return this.tFn(this.value&&this.value.id?"editEvent":"addEvent")},value2:{get:function(){return Boolean(this.value)},set:function(){this.$emit("input",null)}}}},l=s,r=(n("0fc1"),n("2877")),c={components:{drawer:Object(r.a)(l,a,[],!1,null,"54626054",null).exports},data:function(){var t=this.$utils.genDateConfig(90,["today","yesterday","thisWeek","lastWeek","thisMonth","lastMonth","sevent","thirty"]).shortcuts;return{columns:[{title:this.tFn("title"),key:"title"},{title:this.tFn("type"),key:"eventType",slot:"eventType",width:100},{title:this.tFn("createTime"),key:"createTime"},{title:this.tFn("startTime"),key:"beginTime"},{title:this.tFn("endTime"),key:"endTime"},{title:this.tFn("status"),key:"status",slot:"status"},{title:this.tFn("sort"),slot:"sort"},{title:this.tFn("operation"),key:"operation",slot:"operation",width:100}],formItem:{eventStatus:"all",title:"",eventType:"all",time:t[0].value(),timeType:"1"},timeOptions:{shortcuts:t},evtTypeMap:[{text:this.tFn("all"),value:"all"},{text:this.tFn("notStart"),value:"0"},{text:this.tFn("progress"),value:"1"},{text:this.tFn("outDate"),value:"2"}],events:[{text:this.tFn("all"),value:"all"},{text:this.tFn("normalAct"),value:"1"}],timeMap:[{text:this.tFn("createTime"),value:"1"},{text:this.tFn("startTime"),value:"2"},{text:this.tFn("endTime"),value:"3"}],page:1,limit:10,totalElements:0,loading:!1,dataList:[],editItem:null}},mounted:function(){this.getData(1)},methods:{showType:function(t){var e=this.events.find((function(e){return e.value==t.eventType}));return e&&e.text},delRow:function(t){var e=this;this.loading||(this.loading=!0,this.$post("/activity/event/tob/delete",{id:t.id}).then((function(){e.loading=!1,e.getData(1),e.$Message.success(e.tFn("toastMsg1"))})).catch((function(t){e.loading=!1,e.$Message.error(t.message)})))},handleBeforeChange:function(){var t=this;return new Promise((function(e){t.$Modal.confirm({title:t.tFn("toggle"),content:t.tFn("confirmToggle"),onOk:function(){e()}})}))},handleSort:function(t){var e=this;this.loading||(this.loading=!0,this.$post("/activity/event/tob/updateSort",{id:t.id,sort:t.sort}).then((function(){e.$Message.success(e.tFn("toast1"))})).finally((function(){e.loading=!1})))},handleAdd:function(){this.editItem={}},pageSizeChange:function(t){this.limit=t,this.getData(1)},changeIsEnable:function(t){var e=this;if(!this.loading){var n=t.status,a=t.id,i=1===Number(n)?"/activity/event/tob/enable":"/activity/event/tob/disable";this.loading=!0,this.$post(i,{id:a}).then((function(){e.loading=!1,e.getData(1),e.$Message.success(e.tFn("toast1"))})).catch((function(t){e.$Message.error(t.message),e.loading=!1}))}},clearDate:function(){var t=new Date;t.setSeconds(0),t.setMinutes(0),t.setHours(0);var e=new Date(t);t.setSeconds(59),t.setMinutes(59),t.setHours(23);var n=new Date(t);this.formItem.time=[e,n]},tFn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.includes("event.")||(t="event.".concat(t)),this.$t(t,e)},getData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.loading){this.loading=!0;var n=this.formItem,a=n.time,i=n.eventStatus,o=n.eventType,s=n.timeType,l=n.title,r={limit:this.limit,page:this.page=e,beginTime:this.$utils.formatDate(a[0],"YYYY-MM-DD hh:mm:ss"),endTime:this.$utils.formatDate(a[1],"YYYY-MM-DD hh:mm:ss"),eventStatus:"all"===i?"":i,eventType:"all"===o?"":o,timeType:s,title:l};this.$post("/activity/event/tob/page",r).then((function(e){if(e){var n=e.content,a=e.totalElements;t.totalElements=Number(a),t.dataList=n}})).finally((function(){t.loading=!1}))}}}},m=c,u=Object(r.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("m-layout",{attrs:{nav:[{path:"/eventManagement",name:t.nowpagetitle}]}},[t.loading?n("Spin",{attrs:{fix:""}}):t._e(),n("Form",{attrs:{model:t.formItem,inline:""}},[n("FormItem",[t._v(" "+t._s(t.tFn("status"))+": "),n("Select",{staticStyle:{width:"120px"},model:{value:t.formItem.eventStatus,callback:function(e){t.$set(t.formItem,"eventStatus",e)},expression:"formItem.eventStatus"}},t._l(t.evtTypeMap,(function(e,a){return n("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1),n("FormItem",[t._v(" "+t._s(t.tFn("title"))+": "),n("Input",{staticStyle:{width:"120px"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),n("FormItem",[t._v(" "+t._s(t.tFn("type"))+": "),n("Select",{staticStyle:{width:"120px"},model:{value:t.formItem.eventType,callback:function(e){t.$set(t.formItem,"eventType",e)},expression:"formItem.eventType"}},t._l(t.events,(function(e,a){return n("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1),n("FormItem",[n("Select",{staticStyle:{width:"120px"},model:{value:t.formItem.timeType,callback:function(e){t.$set(t.formItem,"timeType",e)},expression:"formItem.timeType"}},t._l(t.timeMap,(function(e,a){return n("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1),n("FormItem",{attrs:{prop:"time"}},[n("DatePicker",{staticStyle:{width:"280px"},attrs:{options:t.timeOptions,type:"datetimerange",format:"yyyy-MM-dd HH:mm",placeholder:t.tFn("placeHolder2")},on:{"on-clear":t.clearDate},model:{value:t.formItem.time,callback:function(e){t.$set(t.formItem,"time",e)},expression:"formItem.time"}})],1),n("FormItem",[n("Button",{attrs:{type:"primary",icon:"md-search"},on:{click:function(e){return t.getData(1)}}},[t._v(t._s(t.tFn("search")))])],1),t.pageauthoritys.add?n("FormItem",[n("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.handleAdd}},[t._v(t._s(t.tFn("addNew")))])],1):t._e()],1),n("m-table",{attrs:{columns:t.columns,data:t.dataList},scopedSlots:t._u([{key:"eventType",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.showType(n))+" ")]}},{key:"status",fn:function(e){var a=e.row;return e.index,[t.pageauthoritys.edit?n("i-switch",{attrs:{size:"large","before-change":t.handleBeforeChange,trueValue:1,falseValue:0},on:{"on-change":function(e){return t.changeIsEnable(a)}},model:{value:a.status,callback:function(e){t.$set(a,"status",e)},expression:"row.status"}},[n("span",{attrs:{slot:"open"},slot:"open"},[t._v(t._s(t.tFn("enable")))]),n("span",{attrs:{slot:"close"},slot:"close"},[t._v(t._s(t.tFn("disable")))])]):t._e()]}},{key:"sort",fn:function(e){var a=e.row;return e.index,[n("Input",{staticStyle:{width:"120px"},on:{"on-blur":function(e){return t.handleSort(a)}},model:{value:a.sort,callback:function(e){t.$set(a,"sort",e)},expression:"row.sort"}})]}},{key:"operation",fn:function(e){var a=e.row;return e.index,[t.pageauthoritys.edit?n("Button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",icon:"md-hammer"},on:{click:function(e){t.editItem=a}}}):t._e(),t.pageauthoritys.delete?n("Poptip",{attrs:{confirm:"",title:t.tFn("confirmText1")},on:{"on-ok":function(e){return t.delRow(a)}}},[n("Button",{attrs:{size:"small",icon:"md-trash"}})],1):t._e()]}}])}),n("m-page",{attrs:{total:t.totalElements,pageSize:t.limit,page:t.page},on:{"on-change":t.getData,"on-page-size-change":t.pageSizeChange},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}),n("drawer",{on:{onSuccess:function(e){return t.getData(1)}},model:{value:t.editItem,callback:function(e){t.editItem=e},expression:"editItem"}})],1)}),[],!1,null,null,null);e.default=u.exports},a897:function(t,e,n){"use strict";var a=(n("ac1f"),n("5319"),n("d3b7"),n("25f0"),{name:"ckeditor4",props:["value","handleShowChange"],mounted:function(){var t=this;t.ckeditor=window.CKEDITOR.replace(t.id),t.ckeditor.setData(t.value),t.ckeditor.config.language=this.$i18n.locale.toLowerCase(),t.ckeditor.config.filebrowserImageUploadUrl="/api/watermelon/commonUpload/tob/upload",t.ckeditor.config.image_previewText=" ",t.ckeditor.on("change",(function(){t.$emit("input",t.ckeditor.getData())})),t.ckeditor.on("blur",(function(e){t.$emit("on-blur",e)})),t.ckeditor.on("fileUploadResponse",(function(t){t.stop();var e=t.data,n=e.fileLoader.xhr,a=JSON.parse(n.responseText);e.url=a.data.url}))},data:function(){return{id:parseInt(1e4*Math.random()).toString(),ckeditor:null}},watch:{value:function(){this.value!==this.ckeditor.getData()&&this.ckeditor.setData(this.value)},handleShowChange:function(){this.ckeditor.setReadOnly(this.handleShowChange)}},beforeDestroy:function(){this.ckeditor.destroy()}}),i=a,o=n("2877"),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("textarea",{attrs:{id:t.id,disabled:t.handleShowChange}})])}),[],!1,null,null,null);e.a=s.exports},ede7:function(t,e,n){}}]);