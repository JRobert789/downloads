(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4e6df650"],{4603:function(t,e,o){},"6e87":function(t,e,o){"use strict";o.r(e);var i=o("2909"),n=o("5530"),r=o("3835"),a=(o("d81d"),o("a630"),o("3ca3"),o("159b"),o("ac1f"),o("466d"),o("d3b7"),o("a9e3"),o("ddb0"),o("99af"),o("b0c0"),o("a434"),o("caad"),o("2532"),o("a897")),l=o("9dac"),s=function(t){throw new Error(t)},c=function(t){return{commodityId:"",lotteryBoxNum:t,probability:null,level:null}},u={name:"turntableSet",components:{editor:a.a,upload:l.a},data:function(){return{loading:!1,showSpin:!1,handleShowChange:!1,formItem:{type:6,timeArr:["",""],conditions:[],url:"",remark:"",consumeScore:null},typeList:[6,9,12],upList:[],commodityList:[]}},computed:{levelList:function(){return Array.from({length:this.formItem.type}).map((function(t,e){return e+1}))}},methods:{saveBefore:function(){var t=this,e=this.formItem,o=e.timeArr,i=e.conditions,n=e.consumeScore;o.some((function(t){return!t}))&&s(this.$t("roulette.timeTip")),n||s(this.$t("roulette.consumeScoreTip"));var r=0;i.forEach((function(e){var o=e.commodityId,i=e.level,n=e.probability;r+=+n,t.isNull(o)&&s(t.$t("roulette.ruleMsg1")),(t.isNull(n)||n<0)&&s(t.$t("roulette.ruleMsg2")),/\d+\.?\d{5}/.test(n)&&s(t.$t("roulette.ruleValidateMsg10")),t.isNull(i)&&s(t.$t("roulette.ruleMsg3"))})),100!==r&&s(this.$t("roulette.ruleValidateMsg9"))},saveHandler:function(){var t=this;try{this.saveBefore()}catch(t){return this.$Message.error(t.message)}var e=this.formItem,o=e.timeArr,i=e.conditions,n=e.type,a=e.remark,l=e.consumeScore,s=e.url;i.forEach((function(t){t.probability=+(t.probability+"").match(/\d+\.?\d{0,4}/)[0]||0}));var c=Object(r.a)(o,2),u=c[0],m=c[1];this.loading=!0;var d={startTime:this.$utils.formatDate(u,"YYYY-MM-DD hh:mm:ss"),endTime:this.$utils.formatDate(m,"YYYY-MM-DD hh:mm:ss"),consumeScore:l,type:n,conditionJson:JSON.stringify(i),remark:a,url:s};this.$post("/activity/roulette/tob/saveOrUpdateConfig",d).then((function(){t.$Message.success(t.$t("success"))})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))},formatConditionJson:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];try{i=JSON.parse(t)}catch(t){i=Array.from({length:e}).map((function(t,e){return c(o+e+1)}))}return i.forEach((function(t){return t.probability=Number(t.probability)})),i},tFn:function(t,e){return this.$t("roulette.".concat(t),e)},uploadSuccess:function(t){this.$set(this.formItem,"url",t.path)},uploadRemove:function(){this.formItem.url=""},isNull:function(t){return null==t||""===t},initHandler:function(){var t=this;this.loading=!0,Promise.all([this.getConfig(),this.getCommodityList()]).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))},getConfig:function(){var t=this;return this.$get("/activity/roulette/tob/getConfig").then((function(e){var o=e.conditionJson,i=e.startTime,n=e.endTime,r=e.url,a=e.consumeScore;return Object.assign(t.formItem,e,{timeArr:[i,n],conditions:t.formatConditionJson(o),consumeScore:Number(a)||null}),r&&(t.upList.length=0,t.upList.push({name:"pic",url:t.$formatImageUrl(r)})),e}))},getCommodityList:function(){var t=this;return this.$get("/activity/roulette/tob/getCommodityList").then((function(e){return t.commodityList=e.map((function(e){return Object(n.a)(Object(n.a)({},e),{},{label:"".concat(e.name," | ").concat(t.$utils.toYuan(e.money)," | ").concat(e.id)})})),t.commodityList}))},handleTypeChange:function(t){var e=this,o=this.formItem.conditions,n=o.length;t>n?o.push.apply(o,Object(i.a)(this.formatConditionJson([],t-n,n))):n>t&&o.splice(t,n),o.forEach((function(t){t.level&&!e.levelList.includes(t.level)&&(t.level=null)}))}},mounted:function(){this.initHandler()}},m=u,d=(o("71e5"),o("2877")),f=Object(d.a)(m,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"turntableSet"},[t.loading?o("Spin",{attrs:{fix:""}}):t._e(),o("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":100}},[o("FormItem",{attrs:{label:t.tFn("logo"),prop:"url"}},[o("upload",{ref:"upRef",attrs:{showTips:!1,list:t.upList},on:{"upload-remove":t.uploadRemove,"upload-success":t.uploadSuccess},model:{value:t.formItem.url,callback:function(e){t.$set(t.formItem,"url",e)},expression:"formItem.url"}}),o("span",[t._v(t._s(t.tFn("uploadTips")))])],1),o("FormItem",{attrs:{label:t.tFn("time"),prop:"time"}},[o("DatePicker",{staticStyle:{width:"220px"},attrs:{format:"yyyy-MM-dd",type:"daterange"},model:{value:t.formItem.timeArr,callback:function(e){t.$set(t.formItem,"timeArr",e)},expression:"formItem.timeArr"}})],1),o("FormItem",{attrs:{label:t.tFn("consumeScore")}},[o("InputNumber",{staticStyle:{width:"220px"},attrs:{min:1},model:{value:t.formItem.consumeScore,callback:function(e){t.$set(t.formItem,"consumeScore",e)},expression:"formItem.consumeScore"}})],1),o("FormItem",{attrs:{label:t.tFn("set")}},[t._v(" "+t._s(t._f("lang")("roulette.style"))+" "),o("RadioGroup",{on:{"on-change":t.handleTypeChange},model:{value:t.formItem.type,callback:function(e){t.$set(t.formItem,"type",e)},expression:"formItem.type"}},t._l(t.typeList,(function(e){return o("Radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])})),1),t._l(t.formItem.conditions,(function(e,i){return o("div",{key:i,staticStyle:{"margin-bottom":"20px","margin-top":"10px"}},[t._v(" "+t._s(t.tFn("drawLabel"))+t._s(e.lotteryBoxNum)+" "+t._s(t.tFn("cid"))+" "),o("Select",{staticStyle:{width:"100px"},model:{value:e.commodityId,callback:function(o){t.$set(e,"commodityId",o)},expression:"item.commodityId"}},t._l(t.commodityList,(function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.label)+" ")])})),1),t._v(" "+t._s(t.tFn("winProbability"))+" "),o("InputNumber",{staticStyle:{width:"100px"},attrs:{max:100,type:"text"},model:{value:e.probability,callback:function(o){t.$set(e,"probability",o)},expression:"item.probability"}}),t._v("% "+t._s(t.tFn("prizeLevel"))+" "),o("Select",{staticStyle:{width:"100px"},model:{value:e.level,callback:function(o){t.$set(e,"level",o)},expression:"item.level"}},t._l(t.levelList,(function(e){return o("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)}))],2),o("FormItem",{attrs:{label:t.$t("event.actReadme")}},[o("editor",{staticStyle:{width:"600px"},attrs:{handleShowChange:t.handleShowChange},model:{value:t.formItem.remark,callback:function(e){t.$set(t.formItem,"remark",e)},expression:"formItem.remark"}})],1),t.pageauthoritys.save?o("FormItem",[o("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:t.loading},on:{click:t.saveHandler}},[t._v(" "+t._s(t.$t("save"))+" ")])],1):t._e()],1),t.showSpin?o("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)}),[],!1,null,null,null);e.default=f.exports},"71e5":function(t,e,o){"use strict";o("4603")},a897:function(t,e,o){"use strict";var i=(o("ac1f"),o("5319"),o("d3b7"),o("25f0"),{name:"ckeditor4",props:["value","handleShowChange"],mounted:function(){var t=this;t.ckeditor=window.CKEDITOR.replace(t.id),t.ckeditor.setData(t.value),t.ckeditor.config.language=this.$i18n.locale.toLowerCase(),t.ckeditor.config.filebrowserImageUploadUrl="/api/watermelon/commonUpload/tob/upload",t.ckeditor.config.image_previewText=" ",t.ckeditor.on("change",(function(){t.$emit("input",t.ckeditor.getData())})),t.ckeditor.on("blur",(function(e){t.$emit("on-blur",e)})),t.ckeditor.on("fileUploadResponse",(function(t){t.stop();var e=t.data,o=e.fileLoader.xhr,i=JSON.parse(o.responseText);e.url=i.data.url}))},data:function(){return{id:parseInt(1e4*Math.random()).toString(),ckeditor:null}},watch:{value:function(){this.value!==this.ckeditor.getData()&&this.ckeditor.setData(this.value)},handleShowChange:function(){this.ckeditor.setReadOnly(this.handleShowChange)}},beforeDestroy:function(){this.ckeditor.destroy()}}),n=i,r=o("2877"),a=Object(r.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("textarea",{attrs:{id:t.id,disabled:t.handleShowChange}})])}),[],!1,null,null,null);e.a=a.exports}}]);