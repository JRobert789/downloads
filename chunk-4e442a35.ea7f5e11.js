(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4e442a35"],{"90f5":function(e,t,a){},c0c0:function(e,t,a){"use strict";a("90f5")},fd35:function(e,t,a){"use strict";a.r(t);var o=a("5530"),n=(a("d81d"),a("d3b7"),a("159b"),a("b64b"),a("b680"),a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Drawer",{attrs:{width:"720"},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}},[e.loading?a("Spin",{attrs:{fix:""}}):e._e(),a("Form",{ref:"form",attrs:{model:e.form,"label-width":200,rules:e.rule}},["edit"==e.opType?a("FormItem",{attrs:{label:"ID",prop:"id"}},[a("Input",{staticClass:"width-300",attrs:{disabled:""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1):e._e(),a("FormItem",{attrs:{label:e.$t("roomManage.goodsName"),prop:"title"}},[a("Input",{staticClass:"width-300",attrs:{maxlength:"200"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.goodsPic"),prop:"image"}},[a("upload",{ref:"upRef1",attrs:{list:e.upList1,maxSize:50},on:{"upload-remove":e.uploadRemove1,"upload-success":e.uploadSuccess1},model:{value:e.form.image,callback:function(t){e.$set(e.form,"image",t)},expression:"form.image"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.goodsPrice"),maxlength:"12",prop:"price"}},[a("InputNumber",{staticClass:"width-300",model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.buyNumber"),prop:"number"}},[a("InputNumber",{staticClass:"width-300",attrs:{min:1,max:99999},model:{value:e.form.number,callback:function(t){e.$set(e.form,"number",t)},expression:"form.number"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.level"),prop:"minLevelLimit"}},[a("InputNumber",{staticClass:"width-300",attrs:{min:1,max:99999},model:{value:e.form.minLevelLimit,callback:function(t){e.$set(e.form,"minLevelLimit",t)},expression:"form.minLevelLimit"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.startTime"),prop:"beginDate"}},[a("DatePicker",{staticClass:"width-200 m-r-20",attrs:{transfer:!0,type:"date",placement:"bottom-end",placeholder:""},on:{"on-clear":e.clearDate},model:{value:e.form.beginDate,callback:function(t){e.$set(e.form,"beginDate",t)},expression:"form.beginDate"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.endTime"),prop:"endDate"}},[a("DatePicker",{staticClass:"width-200 m-r-20",attrs:{transfer:!0,type:"date",placement:"bottom-end",placeholder:""},on:{"on-clear":e.clearDate},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1),a("FormItem",{attrs:{label:e.$t("roomManage.state"),prop:"status"}},[a("i-switch",{attrs:{size:"large","true-value":1,"false-value":0},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e._f("lang")("roomManage.open")))]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e._f("lang")("roomManage.close")))])])],1),a("FormItem",{attrs:{prop:""}},[a("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleConfirm()}}},[e._v(e._s(e._f("lang")("confirm"))+" ")]),a("Button",{on:{click:function(t){e.value2=!1}}},[e._v(e._s(e._f("lang")("cancel"))+" ")])],1)],1)],1)}),s=(a("4d63"),a("ac1f"),a("25f0"),a("9dac")),i=a("2f62"),r={props:{value:{default:!1,type:Boolean},opType:{default:"",type:String},item:{default:null,type:Object}},data:function(){var e=this,t=function(t,a,o){a||o(new Error(e.$t("roomManage.roomToast3"))),a&&o()};return{date:["",""],form:{number:0},rule:{title:[{type:"string",required:!0,message:this.$t("roomManage.roomToast4"),trigger:"blur"}],price:[{type:"number",required:!0,message:this.$t("roomManage.roomToast5"),trigger:"blur"},{validator:function(t,a,o){new RegExp("^(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){0,2})?$").test(a)?o():o(new Error(e.$t("roomManage.roomToast2")))}}],number:[{type:"number",required:!0,message:this.$t("roomManage.roomToast6"),trigger:"blur"},{validator:function(t,a,o){new RegExp("^[0-9]+$").test(a)?o():o(new Error(e.$t("roomManage.roomToast1")))}}],minLevelLimit:[{type:"number",required:!0,message:this.$t("roomManage.roomToast7"),trigger:"blur"}],beginDate:[{required:!0,validator:t,trigger:"blur"}],endDate:[{required:!0,validator:t,trigger:"blur"}]},upList1:[],loading:!1}},mounted:function(){},methods:{change:function(){},clearDate:function(){},handleConfirm:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a={};if(Object.keys(e.form).forEach((function(t){a[t]=e.form[t]})),a.price=(100*a.price).toFixed(0),e.loading)return;e.loading=!0,"edit"==e.opType?e.$post("/trade/goods/tob/update",a).then((function(){e.$Message.success(e.$t("operateSuccess")),e.$emit("onSuccess"),e.value2=!1})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1})):(delete e.form.id,e.$post("/trade/goods/tob/add",a).then((function(){e.$Message.success(e.$t("operateSuccess")),e.$emit("onSuccess"),e.value2=!1})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1})))}}))},uploadRemove1:function(){this.form.image=""},uploadSuccess1:function(e){this.form.image=e.path},setTimeRange:function(e){this.form.beginDate=e[0],this.form.endDate=e[1]}},watch:{value:function(e){e&&(this.$refs.form.resetFields(),"add"==this.opType?this.form={price:null,number:null,minLevelLimit:null,status:0}:this.form=JSON.parse(JSON.stringify(this.item)),this.form.image?(this.upList1.length=0,/^http/.test(this.form.image)?this.upList1.push({name:"pic",url:this.form.image}):this.upList1.push({name:"pic",url:this.imgServer+this.form.image})):this.$refs.upRef1.handleRemove())}},computed:Object(o.a)(Object(o.a)({},Object(i.c)("site",["imgServer"])),{},{value2:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}}),components:{upload:s.a}},l=r,c=a("2877"),m=Object(c.a)(l,n,[],!1,null,null,null).exports,u={data:function(){var e=this;return{beginDate:"",endDate:"",form:{priceMin:null,priceMax:null,minLevelLimitMin:null,minLevelLimitMax:null,state:"all",page:1,size:20},sortType:"",modal1:"",modal2:"",statusList:[{value:"2",label:this.$t("roomManage.all")},{value:"1",label:this.$t("roomManage.on")},{value:"0",label:this.$t("roomManage.off")}],columns:[{type:"selection",width:60,align:"center"},{title:"ID",key:"id"},{title:this.$t("roomManage.goodsName"),key:"title",render:function(e,t){return e("div",[e("span",{style:{display:"inline-block",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},domProps:{title:t.row.title}},t.row.title)])}},{title:this.$t("roomManage.goodsPic"),slot:"image"},{title:this.$t("roomManage.goodsPrice"),key:"price",sortable:!0,sortMethod:function(t,a,o){e.sortType="desc"===o?"desc":"asc"}},{title:this.$t("roomManage.buyNumber"),key:"number"},{title:this.$t("roomManage.level"),key:"minLevelLimit",width:95},{title:this.$t("roomManage.status"),slot:"status",width:95},{title:this.$t("roomManage.startTime"),key:"beginDate"},{title:this.$t("roomManage.endTime"),key:"endDate"},{title:this.$t("roomManage.operate"),key:"operation",slot:"action"}],dataList:[],totalElements:0,editGoods:!1,editItem:{},tabList:[],loading:!1,opType:"",abnormalList:[{value:"all",label:this.$t("roomManage.all")},{value:"0",label:this.$t("roomManage.normal")},{value:"1",label:this.$t("roomManage.missingPicture")}]}},mounted:function(){this.query()},computed:Object(o.a)({},Object(i.c)("site",["imgServer"])),methods:{syncImageHandler:function(){var e=this;if(this.tabList.length){if(!this.loading){this.loading=!0;var t=this.tabList.map((function(e){return e.id}));this.$post("/trade/goods/tob/syncImage",{ids:t},{formatway:"repeat"}).then((function(){e.$Message.success(e.$t("opSuccess"))})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1}))}}else this.$Message.info(this.$t("roomManage.roomToast"))},checkImageHandler:function(){var e=this;this.loading||(this.loading=!0,this.$post("/trade/goods/tob/checkImage").then((function(){e.$Message.success(e.$t("success"))})).finally((function(){e.loading=!1})))},handleBeforeChange:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("roomManage.confrimToggle"),content:e.$t("roomManage.confrimToggleContent"),onOk:function(){t()}})}))},handleChangeStatus:function(e){var t=this;this.loading=!0,this.$post("/trade/goods/tob/batchUpdateStatus",{ids:[e.id],status:e.status},{formatway:"repeat"}).then((function(){t.$Message.success(t.$t("operateSuccess")),t.query()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))},handleCb:function(){this.query()},selectHandle:function(e){this.tabList=e},muilteOp:function(e){var t=this;if(this.tabList.length){var a=[];return this.tabList.map((function(e,t){a.push(e.id)})),"delete"==e?new Promise((function(e){t.$Modal.confirm({title:t.$t("roomManage.confrimToggle2"),content:t.$t("roomManage.confrimToggleContent2"),onOk:function(){t.loading=!0,t.$post("/trade/goods/tob/batchDelete",{ids:a},{formatway:"repeat"}).then((function(){t.$Message.success(t.$t("operateSuccess")),t.query()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}})})):"open"==e?new Promise((function(e){t.$Modal.confirm({title:t.$t("roomManage.confrimToggle3"),content:t.$t("roomManage.confrimToggleContent3"),onOk:function(){t.loading=!0,t.$post("/trade/goods/tob/batchUpdateStatus",{ids:a,status:1},{formatway:"repeat"}).then((function(){t.$Message.success(t.$t("operateSuccess")),t.query()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}})})):"close"==e?new Promise((function(e){t.$Modal.confirm({title:t.$t("roomManage.confrimToggle4"),content:t.$t("roomManage.confrimToggleContent4"),onOk:function(){t.loading=!0,t.$post("/trade/goods/tob/batchUpdateStatus",{ids:a,status:0},{formatway:"repeat"}).then((function(){t.$Message.success(t.$t("operateSuccess")),t.query()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}})})):void 0}this.$Message.info(this.$t("roomManage.roomToast"))},handleDel:function(e){var t=this,a=[e.id];return new Promise((function(e){t.$Modal.confirm({title:t.$t("roomManage.confrimToggle2"),content:t.$t("roomManage.confrimToggleContent5"),onOk:function(){t.loading=!0,t.$post("/trade/goods/tob/batchDelete",{ids:a},{formatway:"repeat"}).then((function(){t.$Message.success(t.$t("operateSuccess")),t.query()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.loading=!1}))}})}))},pageSizeChange:function(e){this.form.size=e,this.query()},setTimeRange1:function(e){this.beginDate=e},setTimeRange2:function(e){this.endDate=e},clearDate1:function(){this.beginDate="",delete this.form.beginDate},clearDate2:function(){this.endDate="",delete this.form.endDate},query:function(){var e=this;this.loading=!0,""!==this.endDate&&(this.form.endDate=this.endDate+" 23:59:59"),""!==this.beginDate&&(this.form.beginDate=this.beginDate+" 00:00:00");var t={};Object.keys(this.form).forEach((function(a){t[a]=e.form[a]})),t.priceMin&&(t.priceMin=(100*t.priceMin).toFixed(0)),t.priceMax&&(t.priceMax=(100*t.priceMax).toFixed(0)),"all"===t.state&&delete t.state,this.$get("/trade/goods/tob/page",t).then((function(t){e.dataList=t.content,e.dataList.map((function(t){t.price/=100,t.image=e.$formatImageUrl(t.image)})),e.totalElements=Number(t.totalElements)})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1}))},handleSearch:function(){this.query()},handleAdd:function(){this.opType="add",this.editGoods=!0,this.editItem={price:null,number:null,minLevelLimit:null}},handleEdit:function(e){this.opType="edit",this.editGoods=!0,this.editItem=JSON.parse(JSON.stringify(e))},sortChange:function(){"desc"==this.sortType?this.form.asc="":this.form.desc="",this.form[this.sortType]&&(this.form[this.sortType]=""),this.form[this.sortType]="price",this.form.page=1,this.query()}},components:{editGoods:m}},d=u,f=(a("c0c0"),Object(c.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.loading?a("Spin",{attrs:{fix:""}}):e._e(),a("div",{staticClass:"label"},[e._v("ID:"),a("Input",{staticClass:"width-120",attrs:{type:"text",clearable:"",placeholder:"ID"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id","string"==typeof t?t.trim():t)},expression:"form.id"}})],1),a("div",{staticClass:"label"},[e._v(e._s(e._f("lang")("roomManage.goodsName"))+":"),a("Input",{staticClass:"width-120",attrs:{type:"text",clearable:"",placeholder:e.$t("roomManage.goodsName")},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title","string"==typeof t?t.trim():t)},expression:"form.title"}})],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.startTime"))+":"),a("DatePicker",{staticClass:"width-120",attrs:{editable:!1,type:"date",placement:"bottom-end",placeholder:""},on:{"on-change":e.setTimeRange1,"on-clear":e.clearDate1},model:{value:e.beginDate,callback:function(t){e.beginDate=t},expression:"beginDate"}})],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.endTime"))+":"),a("DatePicker",{staticClass:"width-120",attrs:{editable:!1,type:"date",placement:"bottom-end",placeholder:""},on:{"on-change":e.setTimeRange2,"on-clear":e.clearDate2},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.status"))+": "),a("Select",{staticClass:"width-120",model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.statusList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.goodsPrice"))+":"),a("InputNumber",{staticClass:"width-120",attrs:{max:999999999},model:{value:e.form.priceMin,callback:function(t){e.$set(e.form,"priceMin","string"==typeof t?t.trim():t)},expression:"form.priceMin"}}),e._v("~"),a("InputNumber",{staticClass:"m-r-20 width-120",attrs:{max:999999999},model:{value:e.form.priceMax,callback:function(t){e.$set(e.form,"priceMax","string"==typeof t?t.trim():t)},expression:"form.priceMax"}})],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.level"))+":"),a("InputNumber",{staticClass:"width-120",attrs:{min:0,max:999999999},model:{value:e.form.minLevelLimitMin,callback:function(t){e.$set(e.form,"minLevelLimitMin","string"==typeof t?t.trim():t)},expression:"form.minLevelLimitMin"}}),e._v("~"),a("InputNumber",{staticClass:"m-r-20 width-120",attrs:{min:1,max:999999999},model:{value:e.form.minLevelLimitMax,callback:function(t){e.$set(e.form,"minLevelLimitMax","string"==typeof t?t.trim():t)},expression:"form.minLevelLimitMax"}})],1),a("div",{staticClass:"label"},[e._v(" "+e._s(e._f("lang")("roomManage.abnormalState"))+": "),a("Select",{staticClass:"width-120",model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},e._l(e.abnormalList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("div",{staticClass:"label"},[a("Button",{staticClass:"m-r-10",attrs:{type:"primary",icon:"md-search"},on:{click:e.handleSearch}},[e._v(e._s(e._f("lang")("roomManage.query")))]),e.pageauthoritys.update?a("Button",{staticClass:"m-r-10",attrs:{type:"primary"},on:{click:function(t){return e.muilteOp("open")}}},[e._v(e._s(e._f("lang")("roomManage.on")))]):e._e(),e.pageauthoritys.update?a("Button",{staticClass:"m-r-10",attrs:{type:"primary"},on:{click:function(t){return e.muilteOp("close")}}},[e._v(e._s(e._f("lang")("roomManage.off")))]):e._e(),e.pageauthoritys.delete?a("Button",{staticClass:"m-r-10",attrs:{type:"primary"},on:{click:function(t){return e.muilteOp("delete")}}},[e._v(e._s(e._f("lang")("roomManage.delete")))]):e._e(),e.pageauthoritys.add?a("Button",{staticClass:"m-r-10",attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v(e._s(e._f("lang")("roomManage.add")))]):e._e(),a("Button",{staticClass:"m-r-10",attrs:{loading:e.loading},on:{click:e.syncImageHandler}},[e._v(" "+e._s(e._f("lang")("roomManage.syncProductPictures"))+" ")]),a("Button",{staticClass:"m-r-10",attrs:{loading:e.loading},on:{click:e.checkImageHandler}},[e._v(" "+e._s(e._f("lang")("roomManage.checkProductPicture"))+" ")])],1),a("Table",{ref:"selection",staticClass:"m-t-20",attrs:{"show-overflow-tooltip":!0,border:"",columns:e.columns,data:e.dataList},on:{"on-sort-change":e.sortChange,"on-selection-change":e.selectHandle},scopedSlots:e._u([{key:"image",fn:function(t){var o=t.row;return[a("img",{staticClass:"commodity_img",attrs:{src:o.image,alt:e.$t("roomManage.none"),onerror:"this.classList.add('error');"}})]}},{key:"status",fn:function(t){var o=t.row;return[a("div",{staticClass:"td-cell"},[a("i-switch",{attrs:{disabled:!e.pageauthoritys.update,"before-change":e.handleBeforeChange,"true-value":1,"false-value":0,size:"large"},on:{"on-change":function(t){return e.handleChangeStatus(o)}},model:{value:o.status,callback:function(t){e.$set(o,"status",t)},expression:"row.status"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e._f("lang")("roomManage.open")))]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e._f("lang")("roomManage.close")))])])],1)]}},{key:"action",fn:function(t){var o=t.row;return[a("div",{staticClass:"td-cell"},[e.pageauthoritys.update?a("Button",{staticClass:"m-r-5",attrs:{icon:"ios-cog"},on:{click:function(t){return e.handleEdit(o)}}}):e._e(),e.pageauthoritys.delete?a("Button",{staticClass:"m-r-5",attrs:{icon:"ios-trash"},on:{click:function(t){return e.handleDel(o)}}}):e._e(),o.goodsUrl?a("a",{staticClass:"btnA",attrs:{href:o.goodsUrl}},[e._v(e._s(e._f("lang")("roomManage.jump")))]):e._e()],1)]}}])}),a("m-page",{ref:"pageRef",attrs:{total:e.totalElements,pageSize:e.form.size,pageSizeOpts:[20,30,50,100,500]},on:{"on-change":e.query,"on-page-size-change":e.pageSizeChange},model:{value:e.form.page,callback:function(t){e.$set(e.form,"page",t)},expression:"form.page"}}),a("editGoods",{attrs:{item:e.editItem,opType:e.opType},on:{onSuccess:e.handleCb},model:{value:e.editGoods,callback:function(t){e.editGoods=t},expression:"editGoods"}})],1)}),[],!1,null,"2579935d",null));t.default=f.exports}}]);