(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-865bd78e"],{"5c76":function(e,t,a){},6549:function(e,t,a){"use strict";a("5c76")},"6de0":function(e,t,a){"use strict";a.r(t);var s=a("5530"),n=(a("d3b7"),a("d81d"),a("caad"),a("a9e3"),a("2f62")),o=(a("99af"),a("b0c0"),a("a15b"),a("929a")),r={props:{value:{default:!1,type:Boolean},roleId:{default:"",type:String}},data:function(){return{treeData:[],showSpin:!1,value2:!1}},computed:{title:function(){return"".concat(this.$t("systemManager.roleManagement"),"-").concat(this.$t("systemManager.permissionSettings"))}},watch:{value:function(){this.value&&(this.query(),this.treeData=this.formeat(this.treeData)),this.value2=this.value},value2:function(){this.$emit("input",this.value2)}},methods:{formeat:function(e){var t=this,a=this.$t("systemManager.buttonMap");return e.map((function(e){return e.expand=e.checked,e.privilege&&a&&a[e.privilege]?e.title=a[e.privilege]:e.title=Object(o.b)({name:e.name,frontPath:e.frontPath}),e.children.length&&t.formeat(e.children),e})),e},query:function(){var e=this;this.showSpin=!0,this.$post("/sys/roleResource/tob/loadTreeData",{roleId:this.roleId}).then((function(t){(t||[]).length&&(e.treeData=e.formeat(t))})).catch((function(t){e.data=[],e.$Message.error(t.message)})).finally((function(){e.showSpin=!1}))},saveTree:function(){var e=this,t=this.$refs.tree.getCheckedAndIndeterminateNodes();if(t.length){this.showSpin=!0;var a=t.map((function(e){return e.id})).join();this.$post("/sys/roleResource/tob/saveRoleResource",{roleId:this.roleId,resources:a}).then((function(){e.$Message.success(e.$t("success")),e.$emit("input",!1)})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.showSpin=!1}))}else this.$Message.info("请选择权限")}}},i=r,l=(a("6549"),a("2877")),c=Object(l.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Drawer",{attrs:{title:e.title,closable:!1,width:"720"},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}},[a("div",{staticClass:"role-treetop",attrs:{slot:"header"},slot:"header"},[a("p",[e._v(" "+e._s(e.title)+" "),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.$emit("input",!1)}}},[e._v(e._s(e._f("lang")("cancel")))]),a("Button",{attrs:{type:"primary",loading:e.showSpin},on:{click:function(t){return e.saveTree()}}},[e._v(e._s(e._f("lang")("save")))])],1)]),a("div",{staticClass:"relative"},[e.showSpin?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),a("Tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","check-strictly":!0}})],1)])}),[],!1,null,null,null),u=c.exports,m={props:{value:{default:!1,type:Boolean},detail:{default:null,type:Object}},data:function(){return{form:{roleName:"",remark:""},showSpin:!1,rule:{roleName:[{required:!0,pattern:/^[^<>]+$/,message:this.$t("systemManager.roleNameTip"),trigger:"blur"}]}}},methods:{save:function(){var e=this;this.$refs.formModal.validate((function(t){if(t){e.showSpin=!0;var a=Boolean(e.detail),s=Object.assign({},e.form),n=a?"/sys/role/tob/updateRole":"/sys/role/tob/saveRole";a&&(s.id=e.detail.id),e.$post(n,s).then((function(){e.$Message.success(e.$t("success")),e.$emit("save")})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.showSpin=!1}))}}))}},computed:{title:function(){var e=this.$t("systemManager.roleManagement"),t=this.detail?this.$t("systemManager.editRole"):this.$t("systemManager.addNewRole");return"".concat(e,"-").concat(t)},value2:{get:function(){if(this.detail){var e=this.detail,t=e.remark,a=e.roleName;this.form.remark=t,this.form.roleName=a}else this.form={remark:"",roleName:""};return this.value},set:function(e){this.$emit("input",e)}}},watch:{value:function(){this.value||this.$refs.formModal.resetFields()}}},d=m,h=Object(l.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{title:e.title},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}},[a("Form",{ref:"formModal",attrs:{model:e.form,rules:e.rule,"label-width":120}},[a("FormItem",{attrs:{label:e.$t("systemManager.roleName"),prop:"roleName"}},[a("Input",{attrs:{type:"text"},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1),a("FormItem",{attrs:{label:e.$t("systemManager.roleDescription"),prop:"remark"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:10}},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"text"},on:{click:function(t){return e.$emit("input",!1)}}},[e._v(e._s(e._f("lang")("cancel")))]),a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.save()}}},[e._v(e._s(e._f("lang")("confirm")))])],1),e.showSpin?a("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)}),[],!1,null,null,null),f={data:function(){return{columns:[{title:this.tfn("roleName"),key:"roleName"},{title:this.tfn("roleDescription"),key:"remark"},{title:this.$t("createTime"),key:"createTime"},{title:this.$t("operation"),key:"operation",slot:"operation"}],showSpin:!1,dataList:[],showDrawer:!1,showModal:!1,detail:null,roleId:""}},methods:{tfn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$t("systemManager.".concat(e),t)},query:function(){var e=this;this.showSpin=!0,this.$post("/sys/role/tob/findRoleByPage",{size:100}).then((function(t){e.dataList=(t.content||[]).map((function(t){return Object.assign({showOptions:e.isSuperAdmin||![0,1].includes(Number(t.id))},t)}))})).catch((function(t){e.$Message.error(t.message),e.dataList=[]})).finally((function(){e.showSpin=!1}))},add:function(){this.showModal=!0,this.detail=null},edit:function(e){this.showModal=!0,this.detail=e},showTree:function(e){this.showDrawer=!0,this.roleId=e},save:function(){this.showModal=!1,this.query()}},components:{drawer:u,modal:h.exports},mounted:function(){this.query()},computed:Object(s.a)({},Object(n.c)("site",["isSuperAdmin"]))},p=f,v=Object(l.a)(p,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{nativeOn:{submit:function(e){e.preventDefault()}}},[a("FormItem",[e.pageauthoritys.save?a("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.add}},[e._v(e._s(e.tfn("addNewRole")))]):e._e()],1)],1),a("m-table",{attrs:{border:"",columns:e.columns,data:e.dataList},scopedSlots:e._u([{key:"operation",fn:function(t){var s=t.row;return[s.showOptions?a("div",{staticClass:"operation-btn-group"},[e.pageauthoritys.saveRoleResource?a("Tooltip",{attrs:{content:e.tfn("modifyRole"),placement:"top"}},[a("Button",{attrs:{size:"small",icon:"md-create"},on:{click:function(t){return e.edit(s)}}})],1):e._e(),e.pageauthoritys.update?a("Tooltip",{attrs:{content:e.tfn("permissionSettings"),placement:"top"}},[a("Button",{attrs:{size:"small",icon:"md-cog"},on:{click:function(t){return e.showTree(s.id)}}})],1):e._e()],1):e._e()]}}])}),a("modal",{attrs:{detail:e.detail},on:{save:function(t){return e.save()}},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}}),a("drawer",{attrs:{roleId:e.roleId},model:{value:e.showDrawer,callback:function(t){e.showDrawer=t},expression:"showDrawer"}}),e.showSpin?a("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)}),[],!1,null,null,null);t.default=v.exports}}]);