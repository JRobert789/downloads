(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-acf1185e"],{"22d8":function(e,t,a){"use strict";a("5175")},3e3:function(e,t,a){},"4b4a":function(e,t,a){"use strict";a.r(t);var n=a("5530"),i=(a("d3b7"),a("a9e3"),a("99af"),a("d81d"),a("3d01")),s=a("1da1"),o=(a("96cf"),a("b680"),a("ac1f"),a("5319"),a("4de4"),a("b64b"),a("a15b"),a("466d"),a("b0c0"),a("d36b")),r={1:o.a.t("roomManage.wholeSite"),2:o.a.t("roomManage.proxyLines"),3:o.a.t("roomManage.member")},l={name:"",props:{value:{type:Object,default:function(){return null}}},data:function(){return{formData:{},explosiveTypeMap:r,refkey:"boomingDrawer",minLimit:101,maxLimit:9999999,loading:!1,rules:{name:[{type:"string",required:!0,message:this.fn("boomingNameIsQequired"),trigger:"blur"}],username:[{type:"string",validator:this.usernameValidator,trigger:"blur"}],proportion:[{validator:this.proportionValidator}]}}},methods:{fn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$t("roomManage.".concat(e),t)},cancelHandler:function(){this.formData={},this.$emit("input",null)},handleBeforeChange:function(){var e=this,t=1===Number(this.formData.explosiveType),a=Number(this.formData.status);return t&&a?new Promise((function(t,a){e.$Modal.confirm({title:e.$t("rebate.confirmPrompt"),content:e.fn("changeStatusTip"),onOk:t,onCancel:a})})):Promise.resolve()},getTemplate:function(){var e=this;this.$download("/trade/explosive/tob/downloadTemplate").catch((function(t){e.$Message.error(t.message)}))},handleUpload:function(e){return e&&(this.formData.file=e,this.validateField("username")),!1},submitHandler:function(){var e=this;if(!this.loading){var t=this.formData.id?"/trade/explosive/tob/update":"/trade/explosive/tob/save";this.$refs[this.refkey].validate().then(function(){var a=Object(s.a)(regeneratorRuntime.mark((function a(n){var i,s,o,r,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!n){a.next=21;break}return a.prev=1,a.next=4,e.handleBeforeChange();case 4:a.next=9;break;case 6:return a.prev=6,a.t0=a.catch(1),a.abrupt("return");case 9:(i=Object.assign({},e.formData)).minBalancePercent=(100*i.minBalancePercent).toFixed(),i.maxBalancePercent=(100*i.maxBalancePercent).toFixed(),i.minBalancePercent>i.maxBalancePercent&&(s=i.minBalancePercent,i.minBalancePercent=i.maxBalancePercent,i.maxBalancePercent=s),i.username&&(i.username=i.username.replace("ï¼Œ",",")),1===Number(i.explosiveType)&&delete i.username,3===Number(i.explosiveType)&&i.file||delete i.file,o={},r=Object.keys(i).filter((function(e){return"file"!==e})),i.file&&(r.length&&(t+="?".concat(r.map((function(e){return"".concat(e,"=").concat(i[e])})).join("&"))),o={"Content-type":"multipart/form-data"},(l=new FormData).append("file",i.file),i=l),e.loading=!0,e.$post(t,i,o).then((function(){e.$Message.success(e.$t("success")),e.$emit("success"),e.cancelHandler()})).catch((function(t){var a=t.message,n=t.originMessage,i=t.code;54005===i&&n&&((n=n.match(/\[.*?\]/g))&&(a="".concat(e.fn("invalidUsername"),":").concat(n," (code: ").concat(i,")"))),e.$Message.error(a)})).finally((function(){e.loading=!1}));case 21:case"end":return a.stop()}}),a,null,[[1,6]])})));return function(e){return a.apply(this,arguments)}}())}},usernameValidator:function(e,t,a){var n=Number(this.formData.explosiveType);if(!t&&!this.isEdit&&(2===n||3===n&&!this.formData.file))return a(this.fn("accountIsQequired"));a()},proportionValidator:function(e,t,a){var n=this.formData,i=n.minBalancePercent,s=n.maxBalancePercent;if(this.minLimit>i||this.minLimit>s)return a(this.fn("percentTip",{min:this.minLimit}));a()},validateField:function(e,t){var a=this.$refs[this.refkey];this.$nextTick((function(){a.validateField(e,t)}))},blurHandler:function(){this.validateField("proportion")}},watch:{show:{handler:function(e){if(e)if(this.$refs[this.refkey]&&this.$refs[this.refkey].resetFields(),this.value&&this.value.id){var t=this.value,a=t.id,n=t.name,i=t.explosiveType,s=t.maxBalancePercent,o=t.minBalancePercent,r=t.status;this.formData={file:null,id:a,name:n,explosiveType:i,maxBalancePercent:s,minBalancePercent:o,status:r,username:""}}else this.formData={name:"",username:"",explosiveType:3,file:null,maxBalancePercent:"",minBalancePercent:"",status:0}}}},computed:{labelWidth:function(){return"en-US"===this.$i18n.locale?150:100},title:function(){return this.isEdit?this.fn("setting"):this.fn("add")},isEdit:function(){return Boolean(this.formData.id)},filename:function(){return this.formData.file&&this.formData.file.name},show:{get:function(){return Boolean(this.value)},set:function(){this.$emit("input",null)}}}},c=l,u=(a("22d8"),a("2877")),m=Object(u.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Drawer",{staticClass:"booming_drawer",attrs:{title:e.title,width:"850"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("Form",{ref:e.refkey,attrs:{"label-width":e.labelWidth,model:e.formData,rules:e.rules}},[a("FormItem",{attrs:{prop:"name",label:e.fn("boomingName")}},[a("Input",{staticStyle:{width:"320px"},attrs:{placeholder:e.fn("boomingName"),maxlength:"254"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name","string"==typeof t?t.trim():t)},expression:"formData.name"}})],1),a("FormItem",{attrs:{required:"",label:e.fn("type")}},[a("RadioGroup",{model:{value:e.formData.explosiveType,callback:function(t){e.$set(e.formData,"explosiveType",t)},expression:"formData.explosiveType"}},e._l(e.explosiveTypeMap,(function(t,n){return a("Radio",{key:n,attrs:{disabled:e.isEdit,label:Number(n)}},[e._v(" "+e._s(t)+" ")])})),1)],1),2===Number(e.formData.explosiveType)?a("FormItem",{attrs:{prop:"username",required:!e.isEdit,label:e.fn("proxyAccount")}},[a("Input",{staticStyle:{width:"320px"},attrs:{placeholder:e.fn("multipleAccountsTip")},model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username","string"==typeof t?t.trim():t)},expression:"formData.username"}})],1):e._e(),3===Number(e.formData.explosiveType)?a("FormItem",{attrs:{prop:"username",required:!e.isEdit,label:e.fn("memberAccount")}},[a("Input",{staticStyle:{width:"320px"},attrs:{placeholder:e.fn("multipleAccountsTip")},model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username","string"==typeof t?t.trim():t)},expression:"formData.username"}}),a("Button",{staticClass:"ml-10",on:{click:e.getTemplate}},[e._v(" "+e._s(e._f("lang")("userGroupManag.downLoadM"))+" ")]),a("Upload",{staticStyle:{display:"inline-block"},attrs:{"before-upload":e.handleUpload,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",action:"/"}},[a("Button",{staticClass:"ml-10",attrs:{icon:"md-cloud-upload"}},[e._v(" "+e._s(e._f("lang")("userGroupManag.getFile"))+" ")])],1),e.filename?a("Button",{on:{click:function(t){e.formData.file=null}}},[e._v(e._s(e.filename)+" "),a("Icon",{attrs:{size:"18",type:"ios-close-circle"}})],1):e._e()],1):e._e(),a("FormItem",{attrs:{required:"",label:e.fn("balanceProportion"),prop:"proportion"}},[a("InputNumber",{staticStyle:{width:"100px"},attrs:{max:e.maxLimit,precision:0},on:{"on-change":e.blurHandler},model:{value:e.formData.minBalancePercent,callback:function(t){e.$set(e.formData,"minBalancePercent",t)},expression:"formData.minBalancePercent"}}),e._v(" % ~ "),a("InputNumber",{staticStyle:{width:"100px"},attrs:{max:e.maxLimit,precision:0},on:{"on-change":e.blurHandler},model:{value:e.formData.maxBalancePercent,callback:function(t){e.$set(e.formData,"maxBalancePercent",t)},expression:"formData.maxBalancePercent"}}),e._v(" % ")],1),a("FormItem",{attrs:{label:e.fn("status")}},[a("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}})],1)],1),a("div",{staticClass:"btns"},[a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.submitHandler}},[e._v(e._s(e._f("lang")("confirm")))]),a("Button",{staticClass:"ml-10",on:{click:e.cancelHandler}},[e._v(e._s(e._f("lang")("cancel")))])],1),e.loading?a("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)}),[],!1,null,"52950c11",null),f=m.exports,d=function(e,t,a){return{title:e,key:t,slot:a}},p={name:"",props:{value:{type:Object,default:function(){return null}}},data:function(){return{username:"",size:20,page:1,dataList:[],columns:[d(this.$t("userGroupManag.groupNo"),"index"),d(this.$t("roomManage.loginAccount"),"username")],totalElements:0,loading:!1}},methods:{pageSizeChange:function(e){this.size=e,this.getData(1)},getData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.loading||(this.loading=!0,this.$get("/trade/explosive/tob/queryUserPage",{explosiveSettingId:this.value.id,page:this.page=t,size:this.size,username:this.username}).then((function(t){var a=t.content,n=t.totalElements;e.dataList=(a||[]).map((function(e,t){return Object.assign({index:t+1},e)})),e.totalElements=Number(n)})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1})))}},computed:{title:function(){return this.value&&this.value.name},show:{get:function(){return!!this.value},set:function(){this.$emit("input",null)}}},watch:{show:function(e){e&&this.getData(1)}}},h=p,g=(a("de54"),Object(u.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Drawer",{staticClass:"booming_users",attrs:{title:e.title,width:"700"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("div",{staticClass:"layout"},[a("div",[e._v(" "+e._s(e._f("lang")("roomManage.loginAccount"))+" "),a("Input",{staticStyle:{width:"120px"},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),a("Button",{staticClass:"ml-10",attrs:{icon:"ios-search",type:"primary"},on:{click:function(t){return e.getData(1)}}},[e._v(e._s(e._f("lang")("search")))])],1),a("m-table",{attrs:{columns:e.columns,data:e.dataList}}),a("m-page",{attrs:{total:e.totalElements,pageSize:e.size,pageSizeOpts:[20,30,50,100,500]},on:{"on-change":e.getData,"on-page-size-change":e.pageSizeChange},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),e.loading?a("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)}),[],!1,null,"2ae157f2",null)),v=g.exports,b=function(e,t,a){return{title:e,key:t,slot:a}},x={data:function(){return{dataList:[],columns:[b(this.$t("userGroupManag.groupNo"),"index"),b(this.fn("boomingName"),"name","name"),b(this.fn("type"),"explosiveTypeText"),b(this.fn("modifyTime"),"updateTime"),b(this.fn("scaleRange"),"percent2Text"),b(this.fn("status"),"status","status"),Object(n.a)(Object(n.a)({},b(this.fn("operate"),"operate","operate")),{},{width:240})],test:!1,loading:!1,page:1,size:20,totalElements:0,explosiveTypeMap:r,eidtItem:null,userListItem:null,globalSwitchData:{loading:!1,status:0,url:"/trade/explosive/tob/updateGlobalSwitch"}}},components:{Nav:i.a,setDrawer:f,userlist:v},methods:{getGlobalSwitch:function(){var e=this;if(!this.globalSwitchData.loading)return this.globalSwitchData.loading=!0,this.$get("/trade/explosive/tob/getGlobalSwitch").then((function(t){e.globalSwitchData.status=Number(t)||0})).finally((function(){e.globalSwitchData.loading=!1}))},formatPercent:function(e){return/^[0-9]+$/.test(e)?e/100:""},percent2Text:function(e,t){return"".concat(this.formatPercent(e),"% ~ ").concat(this.formatPercent(t),"%")},deleteHandler:function(e){var t=this,a=e.id;e.loading||(e.loading=!0,this.$post("/trade/explosive/tob/delete",{id:a}).then((function(){t.getList(1)})).catch((function(a){e.loading=!1,t.$Message.error(a.message)})))},fn:function(e){return this.$t("roomManage.".concat(e))},handleBeforeChange:function(e){var t=this,a=e.status,n=e.explosiveType;if(!e.loading){var i=1===Number(n),s={0:this.fn("openStatusTip"),1:this.fn("closeStatusTip"),wholeSiteTip:this.fn("changeStatusTip")},o=s[a];return i&&0===Number(a)&&(o=s.wholeSiteTip),new Promise((function(){t.$Modal.confirm({title:t.$t("rebate.confirmPrompt"),content:o,onOk:function(){t.changeStatusHandler(e)}})}))}},changeStatusHandler:function(e){var t=this;e.loading=!0;var a=e.id,n=[1,0][e.status],i=e.url||"/trade/explosive/tob/updateSettingStatus",s={status:n,id:a};return s.id||delete s.id,this.$post(i,s).then((function(){e.status=n})).catch((function(e){t.$Message.error(e.message)})).finally((function(){e.loading=!1}))},pageSizeChange:function(e){this.size=e,this.getList(1)},getList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.loading||(this.loading=!0,this.$get("/trade/explosive/tob/querySettingPage",{page:this.page=t,size:this.size,searchCount:!0}).then((function(t){var a=t||{},n=a.content,i=a.totalElements;e.dataList=n.map((function(t,a){return Object.assign(t,{index:a+1,explosiveTypeText:e.explosiveTypeMap[t.explosiveType],percent2Text:e.percent2Text(t.minBalancePercent,t.maxBalancePercent),loading:!1,minBalancePercent:e.formatPercent(t.minBalancePercent),maxBalancePercent:e.formatPercent(t.maxBalancePercent)})})),e.totalElements=Number(i)||0})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.loading=!1})))},globalSwitchHandler:function(){var e=this,t={0:this.fn("openStatusTip"),1:this.fn("closeStatusTip")}[this.globalSwitchData.status];if(!this.globalSwitchData.loading)return new Promise((function(){e.$Modal.confirm({title:e.$t("rebate.confirmPrompt"),content:t,onOk:function(){e.changeStatusHandler(e.globalSwitchData)}})}))}},mounted:function(){this.getList(),this.getGlobalSwitch()}},w=x,y=(a("7432"),Object(u.a)(w,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Nav",{attrs:{nav:[{path:"/orderManage/boomingSet",name:e.nowpagetitle}]}}),a("div",{staticClass:"boomingSet"},[a("div",{staticClass:"booming_buttons"},[a("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:function(t){e.eidtItem={}}}},[e._v(" "+e._s(e._f("lang")("fm.add"))+" ")]),a("div",[e._v(" "+e._s(e.fn("checkOpenTip"))+": "),a("i-switch",{attrs:{loading:e.globalSwitchData.loading,"before-change":e.globalSwitchHandler,"true-value":1,"false-value":0},model:{value:e.globalSwitchData.status,callback:function(t){e.$set(e.globalSwitchData,"status",t)},expression:"globalSwitchData.status"}})],1)],1),a("div",[a("m-table",{staticClass:"m-t-20",attrs:{columns:e.columns,data:e.dataList},scopedSlots:e._u([{key:"name",fn:function(t){var n=t.row;return[a("span",{staticClass:"booming_name",on:{click:function(t){e.userListItem=n}}},[e._v(e._s(n.name))])]}},{key:"status",fn:function(t){var n=t.row;return[a("i-switch",{attrs:{disabled:!e.globalSwitchData.status,loading:n.loading,value:e.globalSwitchData.status?n.status:0,"before-change":function(){return e.handleBeforeChange(n)},"true-value":1,"false-value":0},on:{change:function(e){return n.status=e}}})]}},{key:"operate",fn:function(t){var n=t.row;return[a("Button",{on:{click:function(t){e.eidtItem=n}}},[e._v(" "+e._s(e.fn("setting"))+" ")]),a("Poptip",{attrs:{confirm:"",title:e.fn("confrimToggle2")},on:{"on-ok":function(t){return e.deleteHandler(n)}}},[a("Button",{staticStyle:{"margin-left":"10px"},attrs:{loading:n.loading}},[e._v(" "+e._s(e.fn("delete"))+" ")])],1)]}}])}),e.loading?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),a("m-page",{attrs:{total:e.totalElements,pageSize:e.size,pageSizeOpts:[20,30,50,100,500]},on:{"on-change":e.getList,"on-page-size-change":e.pageSizeChange},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)]),a("setDrawer",{on:{success:function(t){return e.getList(1)}},model:{value:e.eidtItem,callback:function(t){e.eidtItem=t},expression:"eidtItem"}}),a("userlist",{model:{value:e.userListItem,callback:function(t){e.userListItem=t},expression:"userListItem"}})],1)}),[],!1,null,null,null));t.default=y.exports},5175:function(e,t,a){},7432:function(e,t,a){"use strict";a("3000")},"9d1d":function(e,t,a){},de54:function(e,t,a){"use strict";a("9d1d")}}]);